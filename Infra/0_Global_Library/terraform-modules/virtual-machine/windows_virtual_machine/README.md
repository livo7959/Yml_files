# `windows-virtual-machine`

This is an internal [Terraform](https://www.terraform.io/) module to create a [Windows virtual machine ](https://learn.microsoft.com/en-us/azure/virtual-machines/overview) in [Microsoft Azure](https://azure.microsoft.com/en-us).This module provisions an Azure Windows virtual machine with the following default specifications:

- Operating System: Windows Server 2019
- VM Size: Standard_DS2_v2
- Domain: Automatically joins the virtual machine to the corp.logixhealth.local domain
- Storage: Supports the addition of optional data drives beyond the default OS disk

These default settings serve as a starting point and can be modified using module variables to meet your specific requirements.

For more details about available VM sizes, you can refer to the [Azure VM Size documentation](https://learn.microsoft.com/en-us/azure/virtual-machines/sizes/overview?tabs=breakdownseries%2Cgeneralsizelist%2Ccomputesizelist%2Cmemorysizelist%2Cstoragesizelist%2Cgpusizelist%2Cfpgasizelist%2Chpcsizelist).

<!-- BEGIN_TF_DOCS -->

## Requirements

No requirements.

## Providers

| Name                                                         | Version |
| ------------------------------------------------------------ | ------- |
| <a name="provider_azurerm"></a> [azurerm](#provider_azurerm) | 4.15.0  |

## Modules

| Name                                                                                | Source                 | Version |
| ----------------------------------------------------------------------------------- | ---------------------- | ------- |
| <a name="module_common_constants"></a> [common_constants](#module_common_constants) | ../../common/constants | n/a     |

## Resources

| Name                                                                                                                                                                      | Type     |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- |
| [azurerm_managed_disk.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/managed_disk)                                                 | resource |
| [azurerm_network_interface.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_interface)                                       | resource |
| [azurerm_virtual_machine_data_disk_attachment.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/virtual_machine_data_disk_attachment) | resource |
| [azurerm_virtual_machine_extension.domain_join](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/virtual_machine_extension)                | resource |
| [azurerm_windows_virtual_machine.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/windows_virtual_machine)                           | resource |

## Inputs

| Name                                                                                                                                 | Description                                                                                                                                                                                                                                                           | Type                                                                                                                                                                                                                                                 | Default                                                                                   | Required |
| ------------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------- | :------: |
| <a name="input_admin_password"></a> [admin_password](#input_admin_password)                                                          | Local admin password                                                                                                                                                                                                                                                  | `string`                                                                                                                                                                                                                                             | n/a                                                                                       |   yes    |
| <a name="input_admin_username"></a> [admin_username](#input_admin_username)                                                          | Local admin username                                                                                                                                                                                                                                                  | `string`                                                                                                                                                                                                                                             | `"lhadmin"`                                                                               |    no    |
| <a name="input_data_disk_config"></a> [data_disk_config](#input_data_disk_config)                                                    | MAP variable for data disk config                                                                                                                                                                                                                                     | <pre>map(object({<br/> data_disk_storage_account_type = optional(string, "StandardSSD_LRS")<br/> create_option = optional(string, "Empty")<br/> disk_size_gb = optional(number, 32)<br/> caching = optional(string, "ReadWrite")<br/><br/> }))</pre> | `{}`                                                                                      |    no    |
| <a name="input_domain_name"></a> [domain_name](#input_domain_name)                                                                   | Name of the domain to join                                                                                                                                                                                                                                            | `string`                                                                                                                                                                                                                                             | `"corp.logixhealth.local"`                                                                |    no    |
| <a name="input_domain_password"></a> [domain_password](#input_domain_password)                                                       | Password of the account used to join the virtual machine to the domain                                                                                                                                                                                                | `string`                                                                                                                                                                                                                                             | `null`                                                                                    |    no    |
| <a name="input_domain_user_upn"></a> [domain_user_upn](#input_domain_user_upn)                                                       | Account being used to join virtual machines to the domain (do not include domain name as this is appended)                                                                                                                                                            | `string`                                                                                                                                                                                                                                             | `null`                                                                                    |    no    |
| <a name="input_enable_automatic_updates"></a> [enable_automatic_updates](#input_enable_automatic_updates)                            | Specifies if Automatic Updates are Enabled for the Windows Virtual Machine. Changing this forces a new resource to be created                                                                                                                                         | `bool`                                                                                                                                                                                                                                               | `true`                                                                                    |    no    |
| <a name="input_enable_domain_join"></a> [enable_domain_join](#input_enable_domain_join)                                              | Does the Virtual Machine need to be domain joined                                                                                                                                                                                                                     | `bool`                                                                                                                                                                                                                                               | `true`                                                                                    |    no    |
| <a name="input_encryption_at_host_enabled"></a> [encryption_at_host_enabled](#input_encryption_at_host_enabled)                      | Should all of the disks (including the temp disk) attached to this Virtual Machine be encrypted by enabling Encryption at Host? (not enabled for Sandbox subscription)                                                                                                | `bool`                                                                                                                                                                                                                                               | `true`                                                                                    |    no    |
| <a name="input_environment"></a> [environment](#input_environment)                                                                   | Environment shortname                                                                                                                                                                                                                                                 | `string`                                                                                                                                                                                                                                             | n/a                                                                                       |   yes    |
| <a name="input_hotpatching_enabled"></a> [hotpatching_enabled](#input_hotpatching_enabled)                                           | Should the VM be patched without requiring a reboot? Only supported on 2022 Server OS                                                                                                                                                                                 | `bool`                                                                                                                                                                                                                                               | `false`                                                                                   |    no    |
| <a name="input_identity"></a> [identity](#input_identity)                                                                            | Identity configuration for the Container App                                                                                                                                                                                                                          | <pre>object({<br/> type = string<br/> identity_ids = optional(list(string))<br/> })</pre>                                                                                                                                                            | `null`                                                                                    |    no    |
| <a name="input_location"></a> [location](#input_location)                                                                            | The Azure location where the Windows Virtual Machine should exist. Changing this forces a new resource to be created                                                                                                                                                  | `string`                                                                                                                                                                                                                                             | n/a                                                                                       |   yes    |
| <a name="input_os_disk_caching"></a> [os_disk_caching](#input_os_disk_caching)                                                       | The Type of Caching which should be used for the Internal OS Disk. Possible values are None, ReadOnly and ReadWrite                                                                                                                                                   | `string`                                                                                                                                                                                                                                             | `"ReadWrite"`                                                                             |    no    |
| <a name="input_os_storage_account_type"></a> [os_storage_account_type](#input_os_storage_account_type)                               | Size of the machine to deploy                                                                                                                                                                                                                                         | `string`                                                                                                                                                                                                                                             | `"StandardSSD_LRS"`                                                                       |    no    |
| <a name="input_ou_path"></a> [ou_path](#input_ou_path)                                                                               | Organizational unit path for the virtual machine                                                                                                                                                                                                                      | `string`                                                                                                                                                                                                                                             | `"OU=Tier1-Servers,OU=Azure-EastUS,OU=Cloud-Datacenters,DC=CORP,DC=LOGIXHEALTH,DC=LOCAL"` |    no    |
| <a name="input_patch_assessment_mode"></a> [patch_assessment_mode](#input_patch_assessment_mode)                                     | Specifies the mode of in-guest patching to this Windows Virtual Machine. Possible values are Manual, AutomaticByOS and AutomaticByPlatform. Defaults to AutomaticByOS                                                                                                 | `string`                                                                                                                                                                                                                                             | `"ImageDefault"`                                                                          |    no    |
| <a name="input_patch_mode"></a> [patch_mode](#input_patch_mode)                                                                      | Specifies the mode of in-guest patching to this Windows Virtual Machine. Possible values are Manual, AutomaticByOS and AutomaticByPlatform. Defaults to AutomaticByOS                                                                                                 | `string`                                                                                                                                                                                                                                             | `"AutomaticByOS"`                                                                         |    no    |
| <a name="input_private_ip_address_allocation"></a> [private_ip_address_allocation](#input_private_ip_address_allocation)             | The allocation method used for the Private IP Address. Possible values are Dynamic and Static                                                                                                                                                                         | `string`                                                                                                                                                                                                                                             | `"Dynamic"`                                                                               |    no    |
| <a name="input_provision_vm_agent"></a> [provision_vm_agent](#input_provision_vm_agent)                                              | Should the Azure VM Agent be provisioned on this Virtual Machine?                                                                                                                                                                                                     | `bool`                                                                                                                                                                                                                                               | `true`                                                                                    |    no    |
| <a name="input_reboot_setting"></a> [reboot_setting](#input_reboot_setting)                                                          | Specifies the reboot setting for platform scheduled patching. Possible values are Always, IfRequired and Never                                                                                                                                                        | `string`                                                                                                                                                                                                                                             | `"Always"`                                                                                |    no    |
| <a name="input_resource_group_name"></a> [resource_group_name](#input_resource_group_name)                                           | The name of the Resource Group in which the Windows Virtual Machine should be exist. Changing this forces a new resource to be created                                                                                                                                | `string`                                                                                                                                                                                                                                             | n/a                                                                                       |   yes    |
| <a name="input_secure_boot_enabled"></a> [secure_boot_enabled](#input_secure_boot_enabled)                                           | Secure boot enabled                                                                                                                                                                                                                                                   | `bool`                                                                                                                                                                                                                                               | `false`                                                                                   |    no    |
| <a name="input_source_image_offer"></a> [source_image_offer](#input_source_image_offer)                                              | Specifies the offer of the image used to create the virtual machines. Changing this forces a new resource to be created                                                                                                                                               | `string`                                                                                                                                                                                                                                             | `"WindowsServer"`                                                                         |    no    |
| <a name="input_source_image_publisher"></a> [source_image_publisher](#input_source_image_publisher)                                  | Specifies the publisher of the image used to create the virtual machines. Changing this forces a new resource to be created                                                                                                                                           | `string`                                                                                                                                                                                                                                             | `"MicrosoftWindowsServer"`                                                                |    no    |
| <a name="input_source_image_sku"></a> [source_image_sku](#input_source_image_sku)                                                    | Specifies the SKU of the image used to create the virtual machines. Changing this forces a new resource to be created                                                                                                                                                 | `string`                                                                                                                                                                                                                                             | `"2019-Datacenter"`                                                                       |    no    |
| <a name="input_source_image_version"></a> [source_image_version](#input_source_image_version)                                        | Specifies the version of the image used to create the virtual machines. Changing this forces a new resource to be created                                                                                                                                             | `string`                                                                                                                                                                                                                                             | `"latest"`                                                                                |    no    |
| <a name="input_storage_account_uri"></a> [storage_account_uri](#input_storage_account_uri)                                           | Storage account uri for boot diagnostics                                                                                                                                                                                                                              | `string`                                                                                                                                                                                                                                             | `null`                                                                                    |    no    |
| <a name="input_subnet_id"></a> [subnet_id](#input_subnet_id)                                                                         | The ID of the Subnet where this Network Interface should be located in                                                                                                                                                                                                | `string`                                                                                                                                                                                                                                             | n/a                                                                                       |   yes    |
| <a name="input_tags"></a> [tags](#input_tags)                                                                                        | A mapping of tags to assign to the resource                                                                                                                                                                                                                           | `map(string)`                                                                                                                                                                                                                                        | `{}`                                                                                      |    no    |
| <a name="input_virtual_machine_name"></a> [virtual_machine_name](#input_virtual_machine_name)                                        | The name of the Windows Virtual Machine. Changing this forces a new resource to be created                                                                                                                                                                            | `string`                                                                                                                                                                                                                                             | n/a                                                                                       |   yes    |
| <a name="input_virtual_machine_size"></a> [virtual_machine_size](#input_virtual_machine_size)                                        | The SKU which should be used for this Virtual Machine. https://learn.microsoft.com/en-us/azure/virtual-machines/sizes/overview?tabs=breakdownseries%2Cgeneralsizelist%2Ccomputesizelist%2Cmemorysizelist%2Cstoragesizelist%2Cgpusizelist%2Cfpgasizelist%2Chpcsizelist | `string`                                                                                                                                                                                                                                             | `"Standard_DS2_v2"`                                                                       |    no    |
| <a name="input_vm_agent_platform_updates_enabled"></a> [vm_agent_platform_updates_enabled](#input_vm_agent_platform_updates_enabled) | Specifies whether VMAgent Platform Updates is enabled                                                                                                                                                                                                                 | `bool`                                                                                                                                                                                                                                               | `false`                                                                                   |    no    |
| <a name="input_vtpm_enabled"></a> [vtpm_enabled](#input_vtpm_enabled)                                                                | Virtual TPM enabled                                                                                                                                                                                                                                                   | `bool`                                                                                                                                                                                                                                               | `false`                                                                                   |    no    |
| <a name="input_zone"></a> [zone](#input_zone)                                                                                        | Specifies the Availability Zone in which this Windows Virtual Machine should be located. Changing this forces a new Windows Virtual Machine to be created                                                                                                             | `number`                                                                                                                                                                                                                                             | `1`                                                                                       |    no    |

## Outputs

| Name                                                                                            | Description                 |
| ----------------------------------------------------------------------------------------------- | --------------------------- |
| <a name="output_virtual_machine_id"></a> [virtual_machine_id](#output_virtual_machine_id)       | ID of the Virtual Machine   |
| <a name="output_virtual_machine_name"></a> [virtual_machine_name](#output_virtual_machine_name) | Name of the Virtual Machine |

<!-- END_TF_DOCS -->
