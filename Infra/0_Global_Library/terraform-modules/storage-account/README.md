# `storage-account`

This is an internal [Terraform](https://www.terraform.io/) module to create a [storage account](https://learn.microsoft.com/en-us/azure/storage/common/storage-account-overview) in [Microsoft Azure](https://azure.microsoft.com/en-us).

The [auto-generated documentation](https://github.com/terraform-docs/terraform-docs) for this module is below.

## Examples

See the [examples](examples/README.md) directory.

<!-- cspell:ignore GZRS RAGRS RAGZRS -->
<!-- BEGIN_TF_DOCS -->

## Requirements

No requirements.

## Providers

| Name                                                         | Version |
| ------------------------------------------------------------ | ------- |
| <a name="provider_azurerm"></a> [azurerm](#provider_azurerm) | 3.115.0 |

## Modules

| Name                                                                                | Source              | Version |
| ----------------------------------------------------------------------------------- | ------------------- | ------- |
| <a name="module_common_constants"></a> [common_constants](#module_common_constants) | ../common/constants | n/a     |

## Resources

| Name                                                                                                                                                               | Type     |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------- |
| [azurerm_advanced_threat_protection.threat_protection](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/advanced_threat_protection) | resource |
| [azurerm_storage_account.storage_account](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account)                         | resource |
| [azurerm_storage_container.container](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_container)                           | resource |

## Inputs

| Name                                                                                                                                       | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Type                                                                                                                                                                                                                                                                                                                                                                     | Default                                                                                                                                                                                                                                                              | Required |
| ------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------: |
| <a name="input_access_tier"></a> [access_tier](#input_access_tier)                                                                         | Defines the access tier for `BlobStorage`, `FileStorage` and `StorageV2` accounts. Valid options are `Hot` and `Cool`.                                                                                                                                                                                                                                                                                                                                                                | `string`                                                                                                                                                                                                                                                                                                                                                                 | `"Hot"`                                                                                                                                                                                                                                                              |    no    |
| <a name="input_account_kind"></a> [account_kind](#input_account_kind)                                                                      | Defines the kind of account. Valid options are `BlobStorage`, `BlockBlobStorage`, `FileStorage`, `Storage` and `StorageV2`. Changing this forces a new resource to be created.                                                                                                                                                                                                                                                                                                        | `string`                                                                                                                                                                                                                                                                                                                                                                 | `"StorageV2"`                                                                                                                                                                                                                                                        |    no    |
| <a name="input_account_replication_type"></a> [account_replication_type](#input_account_replication_type)                                  | Defines the type of replication to use for this Storage Account. Valid options are `LRS`, `GRS`, `RAGRS`, `ZRS`, `GZRS` and `RAGZRS`.                                                                                                                                                                                                                                                                                                                                                 | `string`                                                                                                                                                                                                                                                                                                                                                                 | `"ZRS"`                                                                                                                                                                                                                                                              |    no    |
| <a name="input_account_tier"></a> [account_tier](#input_account_tier)                                                                      | Defines the tier to use for this storage account. Valid options are `Standard` and `Premium`. For `BlockBlobStorage` and `FileStorage` accounts, only `Premium` is valid. Changing this forces a new resource to be created.                                                                                                                                                                                                                                                          | `string`                                                                                                                                                                                                                                                                                                                                                                 | `"Standard"`                                                                                                                                                                                                                                                         |    no    |
| <a name="input_advanced_threat_protection_enabled"></a> [advanced_threat_protection_enabled](#input_advanced_threat_protection_enabled)    | See the [documentation](https://docs.microsoft.com/en-us/azure/storage/common/storage-advanced-threat-protection?tabs=azure-portal) for more information.                                                                                                                                                                                                                                                                                                                             | `bool`                                                                                                                                                                                                                                                                                                                                                                   | `false`                                                                                                                                                                                                                                                              |    no    |
| <a name="input_containers"></a> [containers](#input_containers)                                                                            | List of objects to create some blob containers in this storage account.                                                                                                                                                                                                                                                                                                                                                                                                               | <pre>list(object({<br> name = string<br> container_access_type = optional(string, "private")<br> metadata = optional(map(string))<br> }))</pre>                                                                                                                                                                                                                          | `[]`                                                                                                                                                                                                                                                                 |    no    |
| <a name="input_cross_tenant_replication_enabled"></a> [cross_tenant_replication_enabled](#input_cross_tenant_replication_enabled)          | Enable cross tenant replication.                                                                                                                                                                                                                                                                                                                                                                                                                                                      | `bool`                                                                                                                                                                                                                                                                                                                                                                   | `false`                                                                                                                                                                                                                                                              |    no    |
| <a name="input_custom_domain_name"></a> [custom_domain_name](#input_custom_domain_name)                                                    | The custom domain name to use for the Storage Account, which will be validated by Azure.                                                                                                                                                                                                                                                                                                                                                                                              | `string`                                                                                                                                                                                                                                                                                                                                                                 | `null`                                                                                                                                                                                                                                                               |    no    |
| <a name="input_environment"></a> [environment](#input_environment)                                                                         | Environment shortname                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `string`                                                                                                                                                                                                                                                                                                                                                                 | n/a                                                                                                                                                                                                                                                                  |   yes    |
| <a name="input_file_share_authentication"></a> [file_share_authentication](#input_file_share_authentication)                               | Storage Account file shares authentication configuration.                                                                                                                                                                                                                                                                                                                                                                                                                             | <pre>object({<br> directory_type = string<br> active_directory = optional(object({<br> storage_sid = string<br> domain_name = string<br> domain_sid = string<br> domain_guid = string<br> forest_name = string<br> netbios_domain_name = string<br> }))<br> })</pre>                                                                                                     | `null`                                                                                                                                                                                                                                                               |    no    |
| <a name="input_file_share_properties_smb"></a> [file_share_properties_smb](#input_file_share_properties_smb)                               | Storage Account file shares smb properties.                                                                                                                                                                                                                                                                                                                                                                                                                                           | <pre>object({<br> versions = optional(list(string), null)<br> authentication_types = optional(list(string), null)<br> kerberos_ticket_encryption_type = optional(list(string), null)<br> channel_encryption_type = optional(list(string), null)<br> multichannel_enabled = optional(bool, null)<br> })</pre>                                                             | `null`                                                                                                                                                                                                                                                               |    no    |
| <a name="input_file_share_retention_policy_in_days"></a> [file_share_retention_policy_in_days](#input_file_share_retention_policy_in_days) | Storage Account file shares retention policy in days. Enabling this may require additional directory permissions.                                                                                                                                                                                                                                                                                                                                                                     | `number`                                                                                                                                                                                                                                                                                                                                                                 | `null`                                                                                                                                                                                                                                                               |    no    |
| <a name="input_file_shares"></a> [file_shares](#input_file_shares)                                                                         | List of objects to create file shares in the storage account.                                                                                                                                                                                                                                                                                                                                                                                                                         | <pre>list(object({<br> name = string<br> quota_in_gb = number<br> enabled_protocol = optional(string)<br> metadata = optional(map(string))<br> acl = optional(list(object({<br> id = string<br> permissions = string<br> start = optional(string)<br> expiry = optional(string)<br> })))<br> }))</pre>                                                                   | `[]`                                                                                                                                                                                                                                                                 |    no    |
| <a name="input_hns_enabled"></a> [hns_enabled](#input_hns_enabled)                                                                         | Whether hierarchical namespace is enabled. This can be used with Azure Data Lake Storage Gen 2 and must be `true` if `nfsv3_enabled` or `sftp_enabled` is set to `true`. Changing this forces a new resource to be created.                                                                                                                                                                                                                                                           | `bool`                                                                                                                                                                                                                                                                                                                                                                   | `false`                                                                                                                                                                                                                                                              |    no    |
| <a name="input_https_traffic_only_enabled"></a> [https_traffic_only_enabled](#input_https_traffic_only_enabled)                            | Boolean flag which forces HTTPS if enabled.                                                                                                                                                                                                                                                                                                                                                                                                                                           | `bool`                                                                                                                                                                                                                                                                                                                                                                   | `true`                                                                                                                                                                                                                                                               |    no    |
| <a name="input_identity_ids"></a> [identity_ids](#input_identity_ids)                                                                      | Specifies a list of user-assigned managed identity IDs to be assigned to this storage account.                                                                                                                                                                                                                                                                                                                                                                                        | `list(string)`                                                                                                                                                                                                                                                                                                                                                           | `null`                                                                                                                                                                                                                                                               |    no    |
| <a name="input_identity_type"></a> [identity_type](#input_identity_type)                                                                   | Specifies the type of managed identity that should be configured on this storage account. Possible values are `SystemAssigned`, `UserAssigned`, `SystemAssigned, UserAssigned` (to enable both).                                                                                                                                                                                                                                                                                      | `string`                                                                                                                                                                                                                                                                                                                                                                 | `"SystemAssigned"`                                                                                                                                                                                                                                                   |    no    |
| <a name="input_infrastructure_encryption_enabled"></a> [infrastructure_encryption_enabled](#input_infrastructure_encryption_enabled)       | Enable or disable infrastructure encryption. Can only be set at creation time.                                                                                                                                                                                                                                                                                                                                                                                                        | `bool`                                                                                                                                                                                                                                                                                                                                                                   | `false`                                                                                                                                                                                                                                                              |    no    |
| <a name="input_location"></a> [location](#input_location)                                                                                  | Azure region short name (CAF). e.g. `eus` for East US. See: https://www.jlaundry.nz/2022/azure_region_abbreviations/                                                                                                                                                                                                                                                                                                                                                                  | `string`                                                                                                                                                                                                                                                                                                                                                                 | n/a                                                                                                                                                                                                                                                                  |   yes    |
| <a name="input_min_tls_version"></a> [min_tls_version](#input_min_tls_version)                                                             | The minimum supported TLS version for the storage account.                                                                                                                                                                                                                                                                                                                                                                                                                            | `string`                                                                                                                                                                                                                                                                                                                                                                 | `"TLS1_2"`                                                                                                                                                                                                                                                           |    no    |
| <a name="input_name"></a> [name](#input_name)                                                                                              | Storage account names must be between 3 and 24 characters in length and may contain numbers and lowercase letters only. The name must be unique within Azure. No two storage accounts can have the same name. See the [documentation](https://learn.microsoft.com/en-us/azure/storage/common/storage-account-overview#storage-account-name) for more information. Note that when creating the resource, the name provided will be prefixed with "lh" in order to provide namespacing. | `string`                                                                                                                                                                                                                                                                                                                                                                 | n/a                                                                                                                                                                                                                                                                  |   yes    |
| <a name="input_network_rules"></a> [network_rules](#input_network_rules)                                                                   | Object with attributes: `bypass`, `default_action`, `ip_rules`, `virtual_network_subnet_ids`. Set to `null` to disable.                                                                                                                                                                                                                                                                                                                                                               | <pre>list(object({<br> bypass = optional(list(string), ["AzureServices"])<br> default_action = optional(string, "Deny")<br> ip_rules = optional(list(string))<br> virtual_network_subnet_ids = optional(list(string))<br> }))</pre>                                                                                                                                      | `[]`                                                                                                                                                                                                                                                                 |    no    |
| <a name="input_nfsv3_enabled"></a> [nfsv3_enabled](#input_nfsv3_enabled)                                                                   | Whether NFSv3 protocol is enabled. Changing this forces a new resource to be created.                                                                                                                                                                                                                                                                                                                                                                                                 | `bool`                                                                                                                                                                                                                                                                                                                                                                   | `false`                                                                                                                                                                                                                                                              |    no    |
| <a name="input_private_link_access"></a> [private_link_access](#input_private_link_access)                                                 | List of PrivateLink objects to allow access from.                                                                                                                                                                                                                                                                                                                                                                                                                                     | <pre>list(object({<br> endpoint_resource_id = string<br> endpoint_tenant_id = optional(string, null)<br> }))</pre>                                                                                                                                                                                                                                                       | `[]`                                                                                                                                                                                                                                                                 |    no    |
| <a name="input_public_nested_items_allowed"></a> [public_nested_items_allowed](#input_public_nested_items_allowed)                         | Allow or disallow nested items within this Account to opt into being public.                                                                                                                                                                                                                                                                                                                                                                                                          | `bool`                                                                                                                                                                                                                                                                                                                                                                   | `false`                                                                                                                                                                                                                                                              |    no    |
| <a name="input_public_network_access_enabled"></a> [public_network_access_enabled](#input_public_network_access_enabled)                   | Enabled or disabled public network access.                                                                                                                                                                                                                                                                                                                                                                                                                                            | `bool`                                                                                                                                                                                                                                                                                                                                                                   | `false`                                                                                                                                                                                                                                                              |    no    |
| <a name="input_queue_properties_logging"></a> [queue_properties_logging](#input_queue_properties_logging)                                  | Logging queue properties                                                                                                                                                                                                                                                                                                                                                                                                                                                              | <pre>object({<br> delete = optional(bool, true)<br> read = optional(bool, true)<br> write = optional(bool, true)<br> version = optional(string, "1.0")<br> retention_policy_days = optional(number, 10)<br> })</pre>                                                                                                                                                     | `{}`                                                                                                                                                                                                                                                                 |    no    |
| <a name="input_queues"></a> [queues](#input_queues)                                                                                        | List of objects to create some Queues in this Storage Account.                                                                                                                                                                                                                                                                                                                                                                                                                        | <pre>list(object({<br> name = string<br> metadata = optional(map(string))<br> }))</pre>                                                                                                                                                                                                                                                                                  | `[]`                                                                                                                                                                                                                                                                 |    no    |
| <a name="input_resource_group"></a> [resource_group](#input_resource_group)                                                                | Name of the resource group that this virtual network should be inside. Should be in the format of: `rg-foo`                                                                                                                                                                                                                                                                                                                                                                           | `string`                                                                                                                                                                                                                                                                                                                                                                 | n/a                                                                                                                                                                                                                                                                  |   yes    |
| <a name="input_sftp_enabled"></a> [sftp_enabled](#input_sftp_enabled)                                                                      | Whether SFTP access is enabled.                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `bool`                                                                                                                                                                                                                                                                                                                                                                   | `false`                                                                                                                                                                                                                                                              |    no    |
| <a name="input_shared_access_key_enabled"></a> [shared_access_key_enabled](#input_shared_access_key_enabled)                               | Indicates whether the storage account permits requests to be authorized with the account access key via Shared Key. If false, then all requests, including shared access signatures, must be authorized with Azure Active Directory (Azure AD).                                                                                                                                                                                                                                       | `bool`                                                                                                                                                                                                                                                                                                                                                                   | `true`                                                                                                                                                                                                                                                               |    no    |
| <a name="input_static_website_config"></a> [static_website_config](#input_static_website_config)                                           | Static website configuration. Can only be set when the `account_kind` is set to `StorageV2` or `BlockBlobStorage`.                                                                                                                                                                                                                                                                                                                                                                    | <pre>object({<br> index_document = optional(string)<br> error_404_document = optional(string)<br> })</pre>                                                                                                                                                                                                                                                               | `null`                                                                                                                                                                                                                                                               |    no    |
| <a name="input_storage_blob_cors_rule"></a> [storage_blob_cors_rule](#input_storage_blob_cors_rule)                                        | See the [documentation](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account#cors_rule) for more information.                                                                                                                                                                                                                                                                                                                              | <pre>object({<br> allowed_headers = list(string)<br> allowed_methods = list(string)<br> allowed_origins = list(string)<br> exposed_headers = list(string)<br> max_age_in_seconds = number<br> })</pre>                                                                                                                                                                   | `null`                                                                                                                                                                                                                                                               |    no    |
| <a name="input_storage_blob_data_protection"></a> [storage_blob_data_protection](#input_storage_blob_data_protection)                      | Storage account blob data protection parameters.                                                                                                                                                                                                                                                                                                                                                                                                                                      | <pre>object({<br> change_feed_enabled = optional(bool, false)<br> versioning_enabled = optional(bool, false)<br> last_access_time_enabled = optional(bool, false)<br> delete_retention_policy_in_days = optional(number, 0)<br> container_delete_retention_policy_in_days = optional(number, 0)<br> container_point_in_time_restore = optional(bool, false)<br> })</pre> | <pre>{<br> "change_feed_enabled": true,<br> "container_delete_retention_policy_in_days": 30,<br> "container_point_in_time_restore": true,<br> "delete_retention_policy_in_days": 30,<br> "last_access_time_enabled": true,<br> "versioning_enabled": true<br>}</pre> |    no    |
| <a name="input_tables"></a> [tables](#input_tables)                                                                                        | List of objects to create some Tables in this Storage Account.                                                                                                                                                                                                                                                                                                                                                                                                                        | <pre>list(object({<br> name = string<br> acl = optional(list(object({<br> id = string<br> permissions = string<br> start = optional(string)<br> expiry = optional(string)<br> })))<br> }))</pre>                                                                                                                                                                         | `[]`                                                                                                                                                                                                                                                                 |    no    |
| <a name="input_tags"></a> [tags](#input_tags)                                                                                              | Tags for the deployment. Tag names are case insensitive, but tag values are case sensitive. The `managedBy = "terraform"` tag will automatically be applied in addition to any other tags specified.                                                                                                                                                                                                                                                                                  | `map(string)`                                                                                                                                                                                                                                                                                                                                                            | `{}`                                                                                                                                                                                                                                                                 |    no    |
| <a name="input_use_subdomain"></a> [use_subdomain](#input_use_subdomain)                                                                   | Whether the custom domain name is validated by using indirect CNAME validation.                                                                                                                                                                                                                                                                                                                                                                                                       | `bool`                                                                                                                                                                                                                                                                                                                                                                   | `false`                                                                                                                                                                                                                                                              |    no    |

## Outputs

No outputs.

<!-- END_TF_DOCS -->
