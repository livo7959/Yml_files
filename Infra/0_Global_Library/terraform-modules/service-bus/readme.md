<!-- BEGIN_TF_DOCS -->

# `service-bus`

This is an internal [Terraform](https://www.terraform.io/) module to create an [Azure Service Bus ](https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-messaging-overview) in [Microsoft Azure](https://azure.microsoft.com/en-us).

This module supports:

- Creating a [Service Bus Namespace](https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-messaging-overview#namespaces)
- Option to create one or multiple [Service Bus Queue(s)](https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-queues-topics-subscriptions#queues)
- Option to create one or multiple [Service Bus Topic(s) with multiple Service Bus Subscriptions](https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-queues-topics-subscriptions#topics-and-subscriptions)

We intentionally left out azurerm_servicebus_topic_authorization_rule and azurerm_servicebus_queue_authorization_rule resources. [Microsoft recommends using RBAC with EntraID for authentication and authorization.](https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-authentication-and-authorization#microsoft-entra-id)
Also left out customer_managed_keys block within azurerm_servicebus_namespace. Can add in later version if there is a strong requirement to self manage.

## Requirements

| Name                                                                     | Version |
| ------------------------------------------------------------------------ | ------- |
| <a name="requirement_terraform"></a> [terraform](#requirement_terraform) | >=1.9.0 |
| <a name="requirement_azurerm"></a> [azurerm](#requirement_azurerm)       | >=4.7.0 |

## Providers

| Name                                                         | Version |
| ------------------------------------------------------------ | ------- |
| <a name="provider_azurerm"></a> [azurerm](#provider_azurerm) | >=4.7.0 |

## Modules

| Name                                                                                | Source              | Version |
| ----------------------------------------------------------------------------------- | ------------------- | ------- |
| <a name="module_common_constants"></a> [common_constants](#module_common_constants) | ../common/constants | n/a     |

## Resources

| Name                                                                                                                                            | Type     |
| ----------------------------------------------------------------------------------------------------------------------------------------------- | -------- |
| [azurerm_servicebus_namespace.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/servicebus_namespace)       | resource |
| [azurerm_servicebus_queue.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/servicebus_queue)               | resource |
| [azurerm_servicebus_subscription.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/servicebus_subscription) | resource |
| [azurerm_servicebus_topic.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/servicebus_topic)               | resource |

## Inputs

| Name                                                                                                                     | Description                                                                                                                                                                                                                                   | Type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Default      | Required |
| ------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------ | :------: |
| <a name="input_capacity"></a> [capacity](#input_capacity)                                                                | Specifies the capacity. When sku is Premium, capacity can be 1, 2, 4, 8 or 16. When sku is Basic or Standard, capacity can be 0 only                                                                                                          | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `null`       |    no    |
| <a name="input_environment"></a> [environment](#input_environment)                                                       | Environment shortname                                                                                                                                                                                                                         | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | n/a          |   yes    |
| <a name="input_identity"></a> [identity](#input_identity)                                                                | The managed identity assigned to the Service Bus Namespace                                                                                                                                                                                    | <pre>map(object({<br/> type = string<br/> identity_ids = optional(list(string), [])<br/> }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `{}`         |    no    |
| <a name="input_local_auth_enabled"></a> [local_auth_enabled](#input_local_auth_enabled)                                  | Whether or not SAS authentication is enabled for the Service Bus namespace. Microsoft recommends RBAC with EntraID                                                                                                                            | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `false`      |    no    |
| <a name="input_location"></a> [location](#input_location)                                                                | Specifies the supported Azure location where the resource exists. Changing this forces a new resource to be created                                                                                                                           | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | n/a          |   yes    |
| <a name="input_minimum_tls_version"></a> [minimum_tls_version](#input_minimum_tls_version)                               | The minimum supported TLS version for this Service Bus Namespace. Valid values are: 1.0, 1.1 and 1.2                                                                                                                                          | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `"1.2"`      |    no    |
| <a name="input_namespace_name"></a> [namespace_name](#input_namespace_name)                                              | Specifies the name of the ServiceBus Namespace resource . Changing this forces a new resource to be created                                                                                                                                   | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | n/a          |   yes    |
| <a name="input_network_rule_set"></a> [network_rule_set](#input_network_rule_set)                                        | Network rule set for the Service Bus Namespace. Only available for Premium namespaces/SKU                                                                                                                                                     | <pre>map(object({<br/> default_action = string<br/> public_network_access_enabled = bool<br/> trusted_services_allowed = bool<br/> ip_rules = list(string)<br/> network_rules = object({<br/> subnet_id = string<br/> ignore_missing_vnet_service_endpoint = bool<br/> })<br/> }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `{}`         |    no    |
| <a name="input_premium_messaging_partitions"></a> [premium_messaging_partitions](#input_premium_messaging_partitions)    | Specifies the number messaging partitions. Only valid when sku is Premium and the minimum number is 1. Possible values include 0, 1, 2, and 4. Defaults to 0 for Standard, Basic namespace. Changing this forces a new resource to be created | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `null`       |    no    |
| <a name="input_public_network_access_enabled"></a> [public_network_access_enabled](#input_public_network_access_enabled) | Is public network access enabled for the Service Bus Namespace?                                                                                                                                                                               | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `true`       |    no    |
| <a name="input_queues"></a> [queues](#input_queues)                                                                      | Map of ServiceBus queues configurations                                                                                                                                                                                                       | <pre>map(object({<br/> lock_duration = optional(string, "PT1M") #1min<br/> max_message_size_in_kilobytes = optional(number, null)<br/> max_size_in_megabytes = optional(number, null) #must be either 1024,2048,3072,4096,or 5120<br/> requires_duplicate_detection = optional(bool, false)<br/> requires_session = optional(bool, false)<br/> default_message_ttl = optional(string, null)<br/> dead_lettering_on_message_expiration = optional(bool, false)<br/> duplicate_detection_history_time_window = optional(string, "PT10M") #10mins<br/> max_delivery_count = optional(number, 10)<br/> status = optional(string, "Active")<br/> batched_operations_enabled = optional(bool, true)<br/> auto_delete_on_idle = optional(string, null)<br/> partitioning_enabled = optional(bool, false)<br/> express_enabled = optional(bool, false)<br/> forward_to = optional(string, null)<br/> forward_dead_lettered_messages_to = optional(string, null)<br/> }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `{}`         |    no    |
| <a name="input_resource_group_name"></a> [resource_group_name](#input_resource_group_name)                               | The name of the resource group in which to create the namespace                                                                                                                                                                               | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | n/a          |   yes    |
| <a name="input_sku"></a> [sku](#input_sku)                                                                               | Defines which tier to use. Options are Basic, Standard or Premium. Please note that setting this field to Premium will force the creation of a new resource. Topics can only be created in Namespaces with a SKU of standard or higher        | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `"Standard"` |    no    |
| <a name="input_tags"></a> [tags](#input_tags)                                                                            | A mapping of tags to assign to the resource                                                                                                                                                                                                   | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | `{}`         |    no    |
| <a name="input_topics"></a> [topics](#input_topics)                                                                      | Map of topics with their configurations and subscriptions                                                                                                                                                                                     | <pre>map(object({<br/> status = optional(string, "Active")<br/> auto_delete_on_idle = optional(string, "P10675199DT2H48M5.4775807S") #10,675,199 days and so on - basically will never automatically be deleted<br/> default_message_ttl = optional(string, "P10675199DT2H48M5.4775807S")<br/> duplicate_detection_history_time_window = optional(string, "PT10M")<br/> batched_operations_enabled = optional(bool, null)<br/> express_enabled = optional(bool, null)<br/> partitioning_enabled = optional(bool, null)<br/> max_message_size_in_kilobytes = optional(number, null)<br/> max_size_in_megabytes = optional(number, 5120)<br/> requires_duplicate_detection = optional(bool, false)<br/> support_ordering = optional(bool, null)<br/> subscriptions = map(object({<br/> max_delivery_count = optional(number, 10)<br/> auto_delete_on_idle = optional(string, null)<br/> default_message_ttl = optional(string, null)<br/> lock_duration = optional(string, "PT1M")<br/> dead_lettering_on_message_expiration = optional(bool, false)<br/> dead_lettering_on_filter_evaluation_error = optional(bool, false)<br/> batched_operations_enabled = optional(bool, false)<br/> requires_session = optional(bool, false)<br/> forward_to = optional(string, null)<br/> forward_dead_lettered_messages_to = optional(string, null)<br/> status = optional(string, "Active")<br/> client_scoped_subscription_enabled = optional(bool, false)<br/> client_scoped_subscription = optional(object({<br/> client_id = string<br/> is_client_scoped_subscription_shareable = optional(bool, false)<br/> }), null)<br/> }))<br/> }))</pre> | `{}`         |    no    |

## Outputs

| Name                                                                                                                 | Description                    |
| -------------------------------------------------------------------------------------------------------------------- | ------------------------------ |
| <a name="output_servicebus_namespace_id"></a> [servicebus_namespace_id](#output_servicebus_namespace_id)             | ID of ServiceBus namespace     |
| <a name="output_servicebus_queue_ids"></a> [servicebus_queue_ids](#output_servicebus_queue_ids)                      | ID of ServiceBus queues        |
| <a name="output_servicebus_subscription_ids"></a> [servicebus_subscription_ids](#output_servicebus_subscription_ids) | ID of ServiceBus subscriptions |
| <a name="output_servicebus_topic_ids"></a> [servicebus_topic_ids](#output_servicebus_topic_ids)                      | ID of ServiceBus topics        |

<!-- END_TF_DOCS -->
